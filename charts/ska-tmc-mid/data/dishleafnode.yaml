name: "dishleafnode-test"
function: telescope-monitoring
domain: general-monitoring
instances: ["001", "036", "063", "100"]
entrypoints:
  - name: "ska_tmc_dishleafnode.dish_leaf_node.DishLeafNode"
server:
  name: "dish_leaf_node"
  instances:
  {{- $isSimulatedDish := .Values.deviceServers.mocks.dish }}
  {{- $real_dish_name := .Values.global.namespace_dish.dish_name }}
  {{- range $instance := .Values.global.dishes }}
  {{- if eq $isSimulatedDish false }}
  {{- range $instance_real := $real_dish_name }}
  {{- $match := regexFind "/ska(\\d{3})/" $instance_real -}}
    - name: "{{ $match }}"
      classes:
      - name: "DishLeafNode"
        devices:
        - name: "ska_mid/tm_leaf_node/d0{{ printf $match }}"
          properties:
          - name: "DishMasterFQDN"
            values:
              - "{{ $instance_real }}"
          - name: "SkaLevel"
            values:
              - "3"
          - name: "LoggingTargetsDefault"
            values:
              - "tango::logger"
          - name: "LoggingLevelDefault"
            values:
              - "5"
          - name: "CommandTimeOut"
            values:
              - "50"
          - name: "polled_attr"
            values:
              - "kValue"
              - "3000"
              - "kValueValidationResult"
              - "3000"
  {{- end }}
  {{- else }}
    - name: "{{ $instance }}"
      classes:
      - name: "DishLeafNode"
        devices:
        - name: "ska_mid/tm_leaf_node/d0{{ printf $instance }}"
          properties:
          - name: "DishMasterFQDN"
            values:
              - "ska{{ printf $instance }}/elt/master" # Mock device FQDN
          - name: "SkaLevel"
            values:
              - "3"
          - name: "LoggingTargetsDefault"
            values:
              - "tango::logger"
          - name: "LoggingLevelDefault"
            values:
              - "5"
          - name: "CommandTimeOut"
            values:
              - "50"
          - name: "polled_attr"
            values:
              - "kValue"
              - "3000"
              - "kValueValidationResult"
              - "3000"
  {{- end }}
  {{- end }}
depends_on:
  - device: sys/database/2
image:
  registry: "{{.Values.dishleafnode.image.registry}}"
  image: "{{.Values.dishleafnode.image.image}}"
  tag: "{{.Values.dishleafnode.image.tag}}"
  pullPolicy: "{{.Values.dishleafnode.image.pullPolicy}}"